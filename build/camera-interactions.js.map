{"version":3,"sources":["../lib/index.js"],"names":[],"mappings":"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","file":"camera-interactions.js","sourcesContent":["/**\n * Sets up an enviroment for detecting that \n * the camera is looking at objects.\n */\n\n'use strict';\nconst EventEmitter = require('fast-event-emitter');\nconst util = require('util');\n\n/*global THREE*/\n/**\n * Keeps track of interactive 3D elements and \n * can be used to trigger events on them.\n *\n * The domElement is to pick up touch ineractions\n * \n * @param  {[type]} domElement [description]\n * @return {[type]}            [description]\n */\nmodule.exports = function CameraInteractivityWorld(domElement) {\n\n\tfunction InteractivityTarget(node) {\n\n\t\tEventEmitter.call(this);\n\n\t\tthis.position = node.position;\n\t\tthis.hasHover = false;\n\t\tthis.object3d = node;\n\n\t\tthis.on('hover', () => {\n\t\t\tif (!this.hasHover) {\n\t\t\t\tthis.emit('hoverStart');\n\t\t\t}\n\t\t\tthis.hasHover = true;\n\t\t});\n\n\t\tthis.on('hoverOut', () => {\n\t\t\tthis.hasHover = false;\n\t\t});\n\n\t\tthis.hide = () =>{\n\t\t\tthis.object3d.visible = false;\n\t\t};\n\n\t\tthis.show = () =>{\n\t\t\tthis.object3d.visible = true;\n\t\t};\n\t}\n\tutil.inherits(InteractivityTarget, EventEmitter);\n\n\tthis.targets = new Map();\n\n\tthis.detectInteractions = function (camera) {\n\n\t\tconst raycaster = new THREE.Raycaster();\n\t\traycaster.setFromCamera(new THREE.Vector2(0,0), camera);\n\t\tconst hits = raycaster.intersectObjects(\n\t\t\tArray.from(this.targets.values())\n\t\t\t.map(target => target.object3d)\n\t\t\t.filter(object3d => object3d.visible)\n\t\t);\n\n\t\tlet target = false;\n\n\t\tif (hits.length) {\n\n\t\t\t// Show hidden text object3d child\n\t\t\ttarget = this.targets.get(hits[0].object);\n\t\t\tif (target) target.emit('hover');\n\t\t}\n\n\t\t// if it is not the one just marked for highlight\n\t\t// and it used to be highlighted un highlight it.\n\t\tArray.from(this.targets.values())\n\t\t.filter(eachTarget => eachTarget !== target)\n\t\t.forEach(eachNotHit => {\n\t\t\tif (eachNotHit.hasHover) eachNotHit.emit('hoverOut');\n\t\t});\n\t};\n\n\tconst interact = (event) => {\n\t\tArray.from(this.targets.values()).forEach(target => {\n\t\t\tif (target.hasHover) {\n\t\t\t\ttarget.emit(event.type);\n\t\t\t}\n\t\t});\n\t};\n\tthis.interact = interact;\n\n\tdomElement.addEventListener('click', interact);\n\tdomElement.addEventListener('mousedown', interact);\n\tdomElement.addEventListener('mouseup', interact);\n\tdomElement.addEventListener('touchup', interact);\n\tdomElement.addEventListener('touchdown', interact);\n\n\tthis.makeTarget = node => {\n\t\tconst newTarget = new InteractivityTarget(node);\n\t\tthis.targets.set(node, newTarget);\n\t\treturn newTarget;\n\t};\n};\n"]}